"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _errors = require("../errors");

/**
 * @see https://github.com/mysqljs/sqlstring/blob/f946198800a8d7f198fcf98d8bb80620595d01ec/lib/SqlString.js#L73
 */
const normalizePositionalParameterReferences = (inputSql, values = [], greatestParameterPosition) => {
  let sql = '';
  let leastMatchedParameterPosition = Infinity;
  let greatestMatchedParameterPosition = 0;
  sql += inputSql.replace(/\$(\d+)/g, (match, g1) => {
    const parameterPosition = parseInt(g1, 10);

    if (parameterPosition > greatestMatchedParameterPosition) {
      greatestMatchedParameterPosition = parameterPosition;
    }

    if (parameterPosition < leastMatchedParameterPosition) {
      leastMatchedParameterPosition = parameterPosition;
    }

    return '$' + (parameterPosition + greatestParameterPosition);
  });

  if (greatestMatchedParameterPosition > values.length) {
    throw new _errors.UnexpectedStateError('The greatest parameter position is greater than the number of parameter values.');
  }

  if (leastMatchedParameterPosition !== Infinity && leastMatchedParameterPosition !== 1) {
    throw new _errors.UnexpectedStateError('Parameter position must start at 1.');
  }

  return {
    sql,
    values
  };
};

var _default = normalizePositionalParameterReferences;
exports.default = _default;
//# sourceMappingURL=normalizePositionalParameterReferences.js.map