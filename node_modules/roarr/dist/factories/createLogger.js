"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _jsonStringifySafe = _interopRequireDefault(require("json-stringify-safe"));

var _sprintfJs = require("sprintf-js");

var _config = require("../config");

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; var ownKeys = Object.keys(source); if (typeof Object.getOwnPropertySymbols === 'function') { ownKeys = ownKeys.concat(Object.getOwnPropertySymbols(source).filter(function (sym) { return Object.getOwnPropertyDescriptor(source, sym).enumerable; })); } ownKeys.forEach(function (key) { _defineProperty(target, key, source[key]); }); } return target; }

function _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }

var version = '1.0.0';
var logLevels = {
  debug: 20,
  error: 50,
  fatal: 60,
  info: 30,
  trace: 10,
  warn: 40
};

var createLogger = function createLogger(onMessage, parentContext) {
  // eslint-disable-next-line id-length
  var log = function log(a, b, c, d, e, f, g, h, i, k) {
    if (!_config.ROARR_LOG && !global.ROARR_LOG) {
      return;
    }

    var time = Date.now();
    var sequence = global.ROARR.sequence++;
    var context;
    var message;

    if (typeof a === 'string') {
      context = _objectSpread({}, parentContext || {});
      message = (0, _sprintfJs.sprintf)(a, b, c, d, e, f, g, h, i, k);
    } else {
      if (typeof b !== 'string') {
        throw new TypeError('Message must be a string.');
      }

      context = JSON.parse((0, _jsonStringifySafe.default)(_objectSpread({}, parentContext || {}, a)));
      message = (0, _sprintfJs.sprintf)(b, c, d, e, f, g, h, i, k);
    }

    onMessage({
      context,
      message,
      sequence,
      time,
      version
    });
  };

  log.child = function (context) {
    if (typeof context === 'function') {
      return createLogger(function (message) {
        if (typeof context !== 'function') {
          throw new TypeError('Unexpected state.');
        }

        onMessage(context(message));
      }, parentContext);
    }

    return createLogger(onMessage, _objectSpread({}, parentContext, context));
  };

  log.getContext = function () {
    return _objectSpread({}, parentContext || {});
  };

  var _arr = Object.keys(logLevels);

  var _loop = function _loop() {
    var logLevel = _arr[_i];

    // eslint-disable-next-line id-length
    log[logLevel] = function (a, b, c, d, e, f, g, h, i, k) {
      return log.child({
        logLevel: logLevels[logLevel]
      })(a, b, c, d, e, f, g, h, i, k);
    };
  };

  for (var _i = 0; _i < _arr.length; _i++) {
    _loop();
  } // @see https://github.com/facebook/flow/issues/6705
  // $FlowFixMe


  return log;
};

var _default = createLogger;
exports.default = _default;
//# sourceMappingURL=createLogger.js.map