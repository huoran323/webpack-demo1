{"version":3,"sources":["../../src/factories/createLogger.js"],"names":["version","logLevels","debug","error","fatal","info","trace","warn","createLogger","onMessage","parentContext","log","a","b","c","d","e","f","g","h","i","k","ROARR_LOG","global","time","Date","now","sequence","ROARR","context","message","TypeError","JSON","parse","child","getContext","Object","keys","logLevel"],"mappings":"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","sourcesContent":["// @flow\n\nimport stringify from 'json-stringify-safe';\nimport {\n  sprintf\n} from 'sprintf-js';\nimport type {\n  LoggerType,\n  MessageContextType,\n  MessageType,\n  TranslateMessageFunctionType\n} from '../types';\nimport {\n  ROARR_LOG\n} from '../config';\n\ntype OnMessageEventHandlerType = (message: MessageType) => void;\n\nconst version = '1.0.0';\n\nconst logLevels = {\n  debug: 20,\n  error: 50,\n  fatal: 60,\n  info: 30,\n  trace: 10,\n  warn: 40\n};\n\nconst createLogger = (onMessage: OnMessageEventHandlerType, parentContext?: MessageContextType): LoggerType => {\n  // eslint-disable-next-line id-length\n  const log = (a, b, c, d, e, f, g, h, i, k) => {\n    if (!ROARR_LOG && !global.ROARR_LOG) {\n      return;\n    }\n\n    const time = Date.now();\n    const sequence = global.ROARR.sequence++;\n\n    let context;\n    let message;\n\n    if (typeof a === 'string') {\n      context = {\n        ...parentContext || {}\n      };\n      message = sprintf(a, b, c, d, e, f, g, h, i, k);\n    } else {\n      if (typeof b !== 'string') {\n        throw new TypeError('Message must be a string.');\n      }\n\n      context = JSON.parse(stringify({\n        ...parentContext || {},\n        ...a\n      }));\n\n      message = sprintf(b, c, d, e, f, g, h, i, k);\n    }\n\n    onMessage({\n      context,\n      message,\n      sequence,\n      time,\n      version\n    });\n  };\n\n  log.child = (context: TranslateMessageFunctionType | MessageContextType): LoggerType => {\n    if (typeof context === 'function') {\n      return createLogger((message) => {\n        if (typeof context !== 'function') {\n          throw new TypeError('Unexpected state.');\n        }\n        onMessage(context(message));\n      }, parentContext);\n    }\n\n    return createLogger(onMessage, {\n      ...parentContext,\n      ...context\n    });\n  };\n\n  log.getContext = (): MessageContextType => {\n    return {\n      ...parentContext || {}\n    };\n  };\n\n  for (const logLevel of Object.keys(logLevels)) {\n    // eslint-disable-next-line id-length\n    log[logLevel] = (a, b, c, d, e, f, g, h, i, k) => {\n      return log.child({\n        logLevel: logLevels[logLevel]\n      })(a, b, c, d, e, f, g, h, i, k);\n    };\n  }\n\n  // @see https://github.com/facebook/flow/issues/6705\n  // $FlowFixMe\n  return log;\n};\n\nexport default createLogger;\n"],"file":"createLogger.js"}