{"version":3,"sources":["../../src/factories/createRoarrInititialGlobalState.js"],"names":["currentState","versions","concat","sort","cmp","currentIsLatestVersion","length","version","includes","push","newState","buffer","prepend","sequence","write","bufferSize","ROARR_BUFFER_SIZE","stream","ROARR_STREAM"],"mappings":";;;;;;;AAEA;;AACA;;AAMA;;AAIA;;;;;;;;AAEA;+EACgBA,Y,EAA+C;AAC7D,MAAMC,QAAQ,GAAG,CAACD,YAAY,CAACC,QAAb,IAAyB,EAA1B,EAA8BC,MAA9B,EAAjB;AAEAD,EAAAA,QAAQ,CAACE,IAAT,CAAcC,sBAAd;AAEA,MAAMC,sBAAsB,GAAG,CAACJ,QAAQ,CAACK,MAAV,IAAoB,4BAAIC,gBAAJ,EAAaN,QAAQ,CAACA,QAAQ,CAACK,MAAT,GAAkB,CAAnB,CAArB,MAAgD,CAAnG;;AAEA,MAAI,CAACL,QAAQ,CAACO,QAAT,CAAkBD,gBAAlB,CAAL,EAAiC;AAC/BN,IAAAA,QAAQ,CAACQ,IAAT,CAAcF,gBAAd;AACD;;AAEDN,EAAAA,QAAQ,CAACE,IAAT,CAAcC,sBAAd;;AAEA,MAAIM,QAAQ;AACVC,IAAAA,MAAM,EAAE,EADE;AAEVC,IAAAA,OAAO,EAAE,EAFC;AAGVC,IAAAA,QAAQ,EAAE;AAHA,KAIPb,YAJO;AAKVC,IAAAA;AALU,IAAZ;;AAQA,MAAII,sBAAsB,IAAI,CAACK,QAAQ,CAACI,KAAxC,EAA+C;AAC7CJ,IAAAA,QAAQ,qBACHA,QADG,EAEH,2BAAa;AACdK,MAAAA,UAAU,EAAEC,yBADE;AAEdC,MAAAA,MAAM,EAAEC;AAFM,KAAb,CAFG,CAAR;AAOD;;AAED,SAAOR,QAAP;AACD,C","sourcesContent":["// @flow\n\nimport cmp from 'semver-compare';\nimport {\n  version\n} from '../../package.json';\nimport type {\n  RoarrGlobalStateType\n} from '../types';\nimport {\n  ROARR_BUFFER_SIZE,\n  ROARR_STREAM\n} from '../config';\nimport createWriter from './createWriter';\n\n// eslint-disable-next-line flowtype/no-weak-types\nexport default (currentState: Object): RoarrGlobalStateType => {\n  const versions = (currentState.versions || []).concat();\n\n  versions.sort(cmp);\n\n  const currentIsLatestVersion = !versions.length || cmp(version, versions[versions.length - 1]) === 1;\n\n  if (!versions.includes(version)) {\n    versions.push(version);\n  }\n\n  versions.sort(cmp);\n\n  let newState = {\n    buffer: '',\n    prepend: {},\n    sequence: 0,\n    ...currentState,\n    versions\n  };\n\n  if (currentIsLatestVersion || !newState.write) {\n    newState = {\n      ...newState,\n      ...createWriter({\n        bufferSize: ROARR_BUFFER_SIZE,\n        stream: ROARR_STREAM\n      })\n    };\n  }\n\n  return newState;\n};\n"],"file":"createRoarrInititialGlobalState.js"}