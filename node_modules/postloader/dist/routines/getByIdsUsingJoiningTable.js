"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _slonik = require("slonik");

var _default = async (connection, joiningTableName, targetResourceTableName, joiningKeyName, lookupKeyName, identifiers, ids) => {
  let rows = [];

  if (ids.length > 0) {
    rows = await connection.any(_slonik.sql`
      SELECT
        ${_slonik.sql.identifier(['r1', lookupKeyName + '_id'])} "POSTLOADER_LOOKUP_KEY",
        ${_slonik.sql.raw(identifiers)}
      FROM ${_slonik.sql.identifier([joiningTableName])} r1
      INNER JOIN ${_slonik.sql.identifier([targetResourceTableName])} r2 ON r2.id = ${_slonik.sql.identifier(['r1', joiningKeyName + '_id'])}
      WHERE ${_slonik.sql.identifier(['r1', lookupKeyName + '_id'])} IN (${_slonik.sql.valueList(ids)})
    `);
  }

  const results = [];

  for (const id of ids) {
    const result = rows.filter(row => {
      return row.POSTLOADER_LOOKUP_KEY === id;
    });
    results.push(result);
  }

  return results;
};

exports.default = _default;
//# sourceMappingURL=getByIdsUsingJoiningTable.js.map